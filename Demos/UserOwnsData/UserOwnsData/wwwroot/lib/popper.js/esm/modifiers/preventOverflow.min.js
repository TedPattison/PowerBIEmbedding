import{top,left,right,bottom,start}from"../enums.js";import getBasePlacement from"../utils/getBasePlacement.js";import getMainAxisFromPlacement from"../utils/getMainAxisFromPlacement.js";import getAltAxis from"../utils/getAltAxis.js";import within from"../utils/within.js";import getLayoutRect from"../dom-utils/getLayoutRect.js";import getOffsetParent from"../dom-utils/getOffsetParent.js";import detectOverflow from"../utils/detectOverflow.js";import getVariation from"../utils/getVariation.js";import getFreshSideObject from"../utils/getFreshSideObject.js";function preventOverflow(t){var e=t.state,i=t.options,r=t.name,o=i.mainAxis,a=void 0===o||o,s=i.altAxis,n=void 0!==s&&s,m=i.boundary,f=i.rootBoundary,l=i.altBoundary,p=i.padding,d=i.tether,g=void 0===d||d,c=i.tetherOffset,u=void 0===c?0:c,h=detectOverflow(e,{boundary:m,rootBoundary:f,padding:p,altBoundary:l}),w=getBasePlacement(e.placement),v=getVariation(e.placement),y=!v,O=getMainAxisFromPlacement(w),j=getAltAxis(O),x=e.modifiersData.popperOffsets,A=e.rects.reference,b=e.rects.popper,P="function"==typeof u?u(Object.assign({},e.rects,{placement:e.placement})):u,B={x:0,y:0};if(x){if(a){var D="y"===O?top:left,F="y"===O?bottom:right,M="y"===O?"height":"width",L=x[O],R=x[O]+h[D],S=x[O]-h[F],V=g?-b[M]/2:0,q=v===start?A[M]:b[M],E=v===start?-b[M]:-A[M],I=e.elements.arrow,T=g&&I?getLayoutRect(I):{width:0,height:0},k=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:getFreshSideObject(),z=k[D],C=k[F],G=within(0,A[M],T[M]),H=y?A[M]/2-V-G-z-P:q-G-z-P,J=y?-A[M]/2+V+G+C+P:E+G+C+P,K=e.elements.arrow&&getOffsetParent(e.elements.arrow),N=K?"y"===O?K.clientTop||0:K.clientLeft||0:0,Q=e.modifiersData.offset?e.modifiersData.offset[e.placement][O]:0,U=x[O]+H-Q-N,W=x[O]+J-Q,X=within(g?Math.min(R,U):R,L,g?Math.max(S,W):S);x[O]=X,B[O]=X-L}if(n){var Y="x"===O?top:left,Z="x"===O?bottom:right,$=x[j],_=$+h[Y],tt=$-h[Z],et=within(_,$,tt);x[j]=et,B[j]=et-$}e.modifiersData[r]=B}}export default{name:"preventOverflow",enabled:!0,phase:"main",fn:preventOverflow,requiresIfExists:["offset"]};